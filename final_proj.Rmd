---
title: "final_proj"
author: "Raymond Hu"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(dplyr)
library(janitor)
```

```{r code, include = FALSE, cache = TRUE}

instacart_products <- read.csv("raw/instacart_2017_05_01/products.csv")
instacart_orders <- read.csv("raw/instacart_2017_05_01/orders.csv")
instacart_order_products_train <- read.csv("raw/instacart_2017_05_01/order_products__train.csv")
instacart_order_products_prior <- read.csv("raw/instacart_2017_05_01/order_products__prior.csv")
instacart_departments <- read.csv("raw/instacart_2017_05_01/departments.csv")
instacart_aisles <- read.csv("raw/instacart_2017_05_01/aisles.csv")

dunn_transaction_data <- read.csv("raw/dunnhumby - The Complete Journey CSV/transaction_data.csv") %>% 
  clean_names()
dunn_product <- read.csv("raw/dunnhumby - The Complete Journey CSV/product.csv") %>% 
  clean_names()
dunn_hh_demographic <- read.csv("raw/dunnhumby - The Complete Journey CSV/hh_demographic.csv") %>% 
  clean_names()
dunn_coupon_redempt <- read.csv("raw/dunnhumby - The Complete Journey CSV/coupon_redempt.csv") %>% 
  clean_names()
dunn_coupon <- read.csv("raw/dunnhumby - The Complete Journey CSV/coupon.csv") %>% 
  clean_names()
dunn_causal_data <- read.csv("raw/dunnhumby - The Complete Journey CSV/causal_data.csv") %>% 
  clean_names()
dunn_campaign_table <- read.csv("raw/dunnhumby - The Complete Journey CSV/campaign_table.csv") %>% 
  clean_names()
dunn_campaign_desc <- read.csv("raw/dunnhumby - The Complete Journey CSV/campaign_desc.csv") %>% 
  clean_names()

```

```{r, echo = FALSE}
# Join Dunnhumby product information to transaction data

dunn_transaction_data_product <- dunn_transaction_data %>% 
  left_join(dunn_product, by = "product_id")

# Combine both density plots to compare the density of purchases through the day
# between in store and instacart data

ggplot() +
  geom_density(aes(x = trans_time/100), 
              fill = "red", 
              data = dunn_transaction_data, 
              adjust = 3, 
              alpha =  0.5) +
  geom_density(aes(x = order_hour_of_day), 
              fill = "blue", 
              data = instacart_orders, 
              adjust = 3, 
              alpha = 0.5) +
  labs(title = "Distribution of Grocery Store Purchases throughout the Day",
      y = "% of Total Purchases",
      x = "Hour of Day") +
  scale_y_continuous(labels = scales::percent) +
  theme_classic() +
  annotate("text", 
           x = 7.25, 
           y= .08, 
           label = "Instacart", 
           color = "blue", 
           size = 4.5) +
  annotate("text", 
           x = 13.75, 
           y= .095, 
           label = "Brick & Mortar \n Grocer", 
           color = "red", 
           size = 4.5) 

```
